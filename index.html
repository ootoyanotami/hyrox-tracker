<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HYROX „Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤</title>
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#0f0f0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HYROX Tracker">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .logo {
            font-size: 36px;
            font-weight: 900;
            letter-spacing: 4px;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 12px;
            letter-spacing: 3px;
            color: #888;
            text-transform: uppercase;
        }

        .workout-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .workout-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 230, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 230, 0, 0.15);
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .workout-name {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .workout-number {
            font-size: 14px;
            color: #666;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 12px;
            border-radius: 20px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .input-wrapper {
            position: relative;
            margin-bottom: 12px;
        }

        .input-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 6px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="number"], input[type="text"], input[type="date"], select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="date"]:focus, select:focus {
            outline: none;
            border-color: #FFE600;
            background: rgba(255, 230, 0, 0.05);
        }

        .add-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            border: none;
            border-radius: 16px;
            color: #000;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 24px;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 230, 0, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 230, 0, 0.5);
            background: linear-gradient(135deg, #FFA500 0%, #FFE600 100%);
        }

        .records-section {
            margin-top: 40px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 230, 0, 0.08) 0%, rgba(255, 165, 0, 0.08) 100%);
            border: 1px solid rgba(255, 230, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(255, 230, 0, 0.1);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Calendar styles */
        .calendar-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .calendar-month {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calendar-month-stat {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calendar-month-stat span {
            color: #FFE600;
            font-weight: 700;
        }

        .calendar-nav {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav:hover {
            background: linear-gradient(135deg, rgba(255, 230, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%);
            border-color: #FFE600;
            box-shadow: 0 2px 10px rgba(255, 230, 0, 0.2);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .weekday {
            text-align: center;
            font-size: 11px;
            color: #888;
            padding: 8px 0;
            text-transform: uppercase;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .calendar-day.other-month {
            color: #444;
        }

        .calendar-day.today {
            border-color: #FFE600;
            color: #FFE600;
        }

        .calendar-day.has-workout {
            background: linear-gradient(135deg, rgba(255, 230, 0, 0.2) 0%, rgba(255, 165, 0, 0.15) 100%);
            border-color: rgba(255, 230, 0, 0.5);
            color: #FFE600;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(255, 230, 0, 0.2);
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 230, 0, 0.4);
        }

        /* Day detail styles */
        .day-detail {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .day-detail-header {
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .workout-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workout-item-info {
            flex: 1;
        }

        .workout-item-name {
            font-size: 15px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }

        .workout-item-notes {
            font-size: 12px;
            color: #888;
        }

        .workout-item-time {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-right: 8px;
        }

        .delete-workout-btn {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: #ff3b30;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }

        .delete-workout-btn:hover {
            background: rgba(255, 59, 48, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">HYROX</div>
            <div class="subtitle">Training Tracker</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalDays">0</div>
                <div class="stat-label">Total Days</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="thisWeek">0</div>
                <div class="stat-label">This Week</div>
            </div>
        </div>

        <div class="workout-card">
            <div class="workout-header">
                <div class="workout-name" id="currentWorkout">„ÉØ„Éº„ÇØ„Ç¢„Ç¶„Éà„ÇíÈÅ∏Êäû</div>
            </div>
            
            <div class="input-wrapper">
                <label class="input-label">Êó•‰ªò</label>
                <select id="workoutDate">
                </select>
            </div>

            <div class="input-wrapper">
                <label class="input-label">Workout Type</label>
                <select id="workoutType">
                    <option value="üèÉ 1000m Run">üèÉ 1000m Run</option>
                    <option value="‚õ∑Ô∏è 1000m SkiErg">‚õ∑Ô∏è 1000m SkiErg</option>
                    <option value="üõ∑ 50m Sled Push">üõ∑ 50m Sled Push</option>
                    <option value="ü™¢ 50m Sled Pull">ü™¢ 50m Sled Pull</option>
                    <option value="üí• 80m Burpee Broad Jump">üí• 80m Burpee Broad Jump</option>
                    <option value="üö£ 1000m Row">üö£ 1000m Row</option>
                    <option value="üèãÔ∏è 200m Farmers Carry">üèãÔ∏è 200m Farmers Carry</option>
                    <option value="üéí 100m Sandbag Lunges">üéí 100m Sandbag Lunges</option>
                    <option value="üéØ Wall Balls (100 reps)">üéØ Wall Balls (100 reps)</option>
                    <option value="custom">‚úèÔ∏è „Åù„ÅÆ‰ªñÔºà„Ç´„Çπ„Çø„É†Ôºâ</option>
                </select>
            </div>

            <div class="input-wrapper" id="customWorkoutWrapper" style="display: none;">
                <label class="input-label">„Ç´„Çπ„Çø„É†Á®ÆÁõÆÂêç</label>
                <input type="text" id="customWorkoutName" placeholder="Á®ÆÁõÆÂêç„ÇíÂÖ•Âäõ">
            </div>

            <div class="input-group">
                <div class="input-wrapper">
                    <label class="input-label">Time (ÂàÜ)</label>
                    <input type="number" id="minutes" placeholder="5" min="0">
                </div>
                <div class="input-wrapper">
                    <label class="input-label">Time (Áßí)</label>
                    <input type="number" id="seconds" placeholder="30" min="0" max="59">
                </div>
            </div>

            <div class="input-wrapper">
                <label class="input-label">„É°„É¢ (‰ªªÊÑè)</label>
                <input type="text" id="notes" placeholder="„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÄÅÈáçÈáè„Å™„Å©">
            </div>

            <button class="add-btn" onclick="addWorkout()">„ÉØ„Éº„ÇØ„Ç¢„Ç¶„Éà„ÇíËøΩÂä†</button>
        </div>

        <div class="calendar-container">
            <div class="calendar-header">
                <button class="calendar-nav" onclick="changeMonth(-1)">‚óÄ</button>
                <div class="calendar-month-info">
                    <div class="calendar-month" id="calendarMonth"></div>
                    <div class="calendar-month-stat" id="monthStat"></div>
                </div>
                <button class="calendar-nav" onclick="changeMonth(1)">‚ñ∂</button>
            </div>
            <div class="calendar-weekdays">
                <div class="weekday">Êó•</div>
                <div class="weekday">Êúà</div>
                <div class="weekday">ÁÅ´</div>
                <div class="weekday">Ê∞¥</div>
                <div class="weekday">Êú®</div>
                <div class="weekday">Èáë</div>
                <div class="weekday">Âúü</div>
            </div>
            <div class="calendar-days" id="calendarDays"></div>
        </div>

        <div class="records-section">
            <div class="section-title">ÈÅ∏Êäû„Åó„ÅüÊó•„ÅÆ„ÉØ„Éº„ÇØ„Ç¢„Ç¶„Éà</div>
            <div id="dayDetail"></div>
        </div>
    </div>

    <script>
        let workoutData = JSON.parse(localStorage.getItem('hyROXWorkouts')) || {};
        let currentMonth = new Date();
        let selectedDate = null;

        // Populate date dropdown with past 30 days
        function populateDateDropdown() {
            const dateSelect = document.getElementById('workoutDate');
            dateSelect.innerHTML = '';
            
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const weekday = weekdays[date.getDay()];
                
                const dateKey = getDateKey(date);
                const displayText = i === 0 
                    ? `Today (${month}Êúà${day}Êó• ${weekday})`
                    : i === 1
                    ? `Yesterday (${month}Êúà${day}Êó• ${weekday})`
                    : `${month}Êúà${day}Êó• (${weekday})`;
                
                const option = document.createElement('option');
                option.value = dateKey;
                option.textContent = displayText;
                dateSelect.appendChild(option);
            }
        }

        function getDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function updateStats() {
            const totalDays = Object.keys(workoutData).length;
            document.getElementById('totalDays').textContent = totalDays;
            
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const thisWeekCount = Object.keys(workoutData).filter(dateKey => {
                return new Date(dateKey) >= oneWeekAgo;
            }).length;
            document.getElementById('thisWeek').textContent = thisWeekCount;
        }

        function formatTime(minutes, seconds) {
            const m = String(minutes || 0).padStart(2, '0');
            const s = String(seconds || 0).padStart(2, '0');
            return `${m}:${s}`;
        }

        function addWorkout() {
            const dateKey = document.getElementById('workoutDate').value;
            let workoutType = document.getElementById('workoutType').value;
            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            const seconds = parseInt(document.getElementById('seconds').value) || 0;
            const notes = document.getElementById('notes').value;

            if (!dateKey) {
                alert('Êó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Handle custom workout type
            if (workoutType === 'custom') {
                const customName = document.getElementById('customWorkoutName').value.trim();
                if (!customName) {
                    alert('„Ç´„Çπ„Çø„É†Á®ÆÁõÆÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                workoutType = '‚úèÔ∏è ' + customName;
            }

            if (minutes === 0 && seconds === 0) {
                alert('„Çø„Ç§„É†„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!workoutData[dateKey]) {
                workoutData[dateKey] = [];
            }

            const workout = {
                id: Date.now(),
                workout: workoutType,
                minutes: minutes,
                seconds: seconds,
                notes: notes
            };

            workoutData[dateKey].push(workout);
            localStorage.setItem('hyROXWorkouts', JSON.stringify(workoutData));

            document.getElementById('minutes').value = '';
            document.getElementById('seconds').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('customWorkoutName').value = '';
            document.getElementById('workoutType').selectedIndex = 0;
            document.getElementById('customWorkoutWrapper').style.display = 'none';

            // Update calendar to reflect the new data
            renderCalendar();
            updateStats();
            
            // Select and show the date we just added to
            selectDate(new Date(dateKey));
        }

        function deleteWorkout(dateKey, workoutId) {
            if (!workoutData[dateKey]) return;
            
            workoutData[dateKey] = workoutData[dateKey].filter(w => w.id !== workoutId);
            
            if (workoutData[dateKey].length === 0) {
                delete workoutData[dateKey];
            }
            
            localStorage.setItem('hyROXWorkouts', JSON.stringify(workoutData));
            
            renderCalendar();
            updateStats();
            if (selectedDate) {
                showDayDetail(selectedDate);
            }
        }

        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('calendarMonth').textContent = 
                `${year}Âπ¥ ${month + 1}Êúà`;

            // Calculate this month's training days
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            
            let monthTrainingDays = 0;
            for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
                const date = new Date(year, month, day);
                const dateKey = getDateKey(date);
                if (workoutData[dateKey] && workoutData[dateKey].length > 0) {
                    monthTrainingDays++;
                }
            }
            
            document.getElementById('monthStat').innerHTML = 
                `Total days (This month): <span>${monthTrainingDays}</span>`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const firstDayOfWeek = firstDay.getDay();
            const lastDate = lastDay.getDate();
            const prevLastDate = prevLastDay.getDate();

            let daysHTML = '';
            const today = new Date();
            const todayKey = getDateKey(today);

            // Previous month days
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevLastDate - i;
                const date = new Date(year, month - 1, day);
                const dateKey = getDateKey(date);
                const hasWorkout = workoutData[dateKey] && workoutData[dateKey].length > 0;
                
                let classes = 'calendar-day other-month';
                if (hasWorkout) classes += ' has-workout';
                
                daysHTML += `<div class="${classes}" onclick="selectDate(new Date(${year}, ${month - 1}, ${day}))">${day}</div>`;
            }

            // Current month days
            for (let day = 1; day <= lastDate; day++) {
                const date = new Date(year, month, day);
                const dateKey = getDateKey(date);
                const hasWorkout = workoutData[dateKey] && workoutData[dateKey].length > 0;
                const isToday = dateKey === todayKey;
                const isSelected = selectedDate && dateKey === getDateKey(selectedDate);
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (hasWorkout) classes += ' has-workout';
                if (isSelected) classes += ' selected';
                
                daysHTML += `<div class="${classes}" onclick="selectDate(new Date(${year}, ${month}, ${day}))">${day}</div>`;
            }

            // Next month days
            const remainingDays = 7 - ((firstDayOfWeek + lastDate) % 7);
            if (remainingDays < 7) {
                for (let day = 1; day <= remainingDays; day++) {
                    const date = new Date(year, month + 1, day);
                    const dateKey = getDateKey(date);
                    const hasWorkout = workoutData[dateKey] && workoutData[dateKey].length > 0;
                    
                    let classes = 'calendar-day other-month';
                    if (hasWorkout) classes += ' has-workout';
                    
                    daysHTML += `<div class="${classes}" onclick="selectDate(new Date(${year}, ${month + 1}, ${day}))">${day}</div>`;
                }
            }

            document.getElementById('calendarDays').innerHTML = daysHTML;
        }

        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
        }

        function selectDate(date) {
            selectedDate = date;
            
            // If the selected date is in a different month, update the calendar view
            if (date.getMonth() !== currentMonth.getMonth() || 
                date.getFullYear() !== currentMonth.getFullYear()) {
                currentMonth = new Date(date.getFullYear(), date.getMonth(), 1);
            }
            
            renderCalendar();
            showDayDetail(date);
            
            // Set the dropdown to the selected date
            const dateKey = getDateKey(date);
            const dateDropdown = document.getElementById('workoutDate');
            
            // Check if date is within the past 30 days
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const selectedDateObj = new Date(date);
            selectedDateObj.setHours(0, 0, 0, 0);
            const daysDiff = Math.floor((today - selectedDateObj) / (1000 * 60 * 60 * 24));
            
            // If date is within dropdown range (0-29 days ago), set it
            if (daysDiff >= 0 && daysDiff < 30) {
                dateDropdown.value = dateKey;
                // Scroll to form for easy access
                document.querySelector('.workout-card').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                // Date is outside range - add it as a temporary option
                // Remove any existing temp option first
                const existingTemp = dateDropdown.querySelector('option[data-temp="true"]');
                if (existingTemp) {
                    existingTemp.remove();
                }
                
                // Add the selected date as a temporary option at the top
                const tempOption = document.createElement('option');
                tempOption.value = dateKey;
                tempOption.setAttribute('data-temp', 'true');
                
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const weekday = weekdays[date.getDay()];
                
                tempOption.textContent = `${month}Êúà${day}Êó• (${weekday}) - ÈÅ∏Êäû‰∏≠`;
                
                // Insert at the beginning
                dateDropdown.insertBefore(tempOption, dateDropdown.firstChild);
                dateDropdown.value = dateKey;
                
                // Scroll to form
                document.querySelector('.workout-card').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function showDayDetail(date) {
            const dateKey = getDateKey(date);
            const workouts = workoutData[dateKey] || [];
            const container = document.getElementById('dayDetail');

            const dateStr = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;

            if (workouts.length === 0) {
                container.innerHTML = `
                    <div class="day-detail">
                        <div class="day-detail-header">${dateStr}</div>
                        <div class="empty-state" style="padding: 30px 20px;">
                            <div style="color: #666;">„Åì„ÅÆÊó•„ÅÆ„ÉØ„Éº„ÇØ„Ç¢„Ç¶„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                        </div>
                    </div>
                `;
                return;
            }

            // Calculate total time
            let totalMinutes = 0;
            let totalSeconds = 0;
            workouts.forEach(workout => {
                totalMinutes += workout.minutes || 0;
                totalSeconds += workout.seconds || 0;
            });
            totalMinutes += Math.floor(totalSeconds / 60);
            totalSeconds = totalSeconds % 60;

            const workoutsHTML = workouts.map(workout => `
                <div class="workout-item">
                    <div class="workout-item-info">
                        <div class="workout-item-name">${workout.workout}</div>
                        ${workout.notes ? `<div class="workout-item-notes">${workout.notes}</div>` : ''}
                    </div>
                    <div class="workout-item-time">${formatTime(workout.minutes, workout.seconds)}</div>
                    <button class="delete-workout-btn" onclick="deleteWorkout('${dateKey}', ${workout.id})">ÂâäÈô§</button>
                </div>
            `).join('');

            const totalTimeHTML = `
                <div style="background: linear-gradient(135deg, rgba(255, 230, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%); border: 1px solid rgba(255, 230, 0, 0.4); border-radius: 12px; padding: 16px; margin-top: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(255, 230, 0, 0.15);">
                    <div style="font-size: 15px; font-weight: 600; background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Total</div>
                    <div style="font-size: 24px; font-weight: 700; background: linear-gradient(135deg, #FFE600 0%, #FFA500 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${formatTime(totalMinutes, totalSeconds)}</div>
                </div>
            `;

            container.innerHTML = `
                <div class="day-detail">
                    <div class="day-detail-header">${dateStr} (${workouts.length}„Çª„ÉÉ„Ç∑„Éß„É≥)</div>
                    ${workoutsHTML}
                    ${totalTimeHTML}
                </div>
            `;
        }

        document.getElementById('workoutType').addEventListener('change', function() {
            const customWrapper = document.getElementById('customWorkoutWrapper');
            if (this.value === 'custom') {
                customWrapper.style.display = 'block';
                document.getElementById('currentWorkout').textContent = '„Ç´„Çπ„Çø„É†Á®ÆÁõÆ';
            } else {
                customWrapper.style.display = 'none';
                document.getElementById('currentWorkout').textContent = this.value;
            }
        });

        // Initialize
        populateDateDropdown();
        renderCalendar();
        updateStats();
        selectDate(new Date());
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
